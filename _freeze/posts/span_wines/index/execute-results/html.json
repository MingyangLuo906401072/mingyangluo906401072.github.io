{
  "hash": "9397b308d92753516aaef7bf9388571a",
  "result": {
    "markdown": "---\ntitle: \"Span Wines Anaysis\"\nauthor: \"Mingyang Luo\"\ndate: \"2023-11-08\"\ncategories: [Classification, Anomaly Detection]\nimage: \"image.jpg\"\n---\n\nThis is a post with executable code.\n\n::: {.cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport numpy as np\nfrom sklearn.compose import ColumnTransformer\nfrom sklearn.preprocessing import StandardScaler, OneHotEncoder\nfrom sklearn.decomposition import PCA\nfrom sklearn.pipeline import Pipeline\nfrom sklearn.impute import SimpleImputer\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.naive_bayes import GaussianNB\nfrom sklearn.metrics import accuracy_score, recall_score, classification_report\nfrom sklearn.model_selection import learning_curve\nfrom sklearn.metrics import confusion_matrix\nfrom sklearn.svm import OneClassSVM\nimport seaborn as sns\nimport warnings\nwarnings.filterwarnings(\"ignore\")\n\ncsv_file_path = \"wines_SPA.csv\"\ndf = pd.read_csv(csv_file_path)\ndf\n```\n\n::: {.cell-output .cell-output-display execution_count=8}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>winery</th>\n      <th>wine</th>\n      <th>year</th>\n      <th>rating</th>\n      <th>num_reviews</th>\n      <th>country</th>\n      <th>region</th>\n      <th>price</th>\n      <th>type</th>\n      <th>body</th>\n      <th>acidity</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>Teso La Monja</td>\n      <td>Tinto</td>\n      <td>2013</td>\n      <td>4.9</td>\n      <td>58</td>\n      <td>Espana</td>\n      <td>Toro</td>\n      <td>995.00</td>\n      <td>Toro Red</td>\n      <td>5.0</td>\n      <td>3.0</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>Artadi</td>\n      <td>Vina El Pison</td>\n      <td>2018</td>\n      <td>4.9</td>\n      <td>31</td>\n      <td>Espana</td>\n      <td>Vino de Espana</td>\n      <td>313.50</td>\n      <td>Tempranillo</td>\n      <td>4.0</td>\n      <td>2.0</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>Vega Sicilia</td>\n      <td>Unico</td>\n      <td>2009</td>\n      <td>4.8</td>\n      <td>1793</td>\n      <td>Espana</td>\n      <td>Ribera del Duero</td>\n      <td>324.95</td>\n      <td>Ribera Del Duero Red</td>\n      <td>5.0</td>\n      <td>3.0</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>Vega Sicilia</td>\n      <td>Unico</td>\n      <td>1999</td>\n      <td>4.8</td>\n      <td>1705</td>\n      <td>Espana</td>\n      <td>Ribera del Duero</td>\n      <td>692.96</td>\n      <td>Ribera Del Duero Red</td>\n      <td>5.0</td>\n      <td>3.0</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>Vega Sicilia</td>\n      <td>Unico</td>\n      <td>1996</td>\n      <td>4.8</td>\n      <td>1309</td>\n      <td>Espana</td>\n      <td>Ribera del Duero</td>\n      <td>778.06</td>\n      <td>Ribera Del Duero Red</td>\n      <td>5.0</td>\n      <td>3.0</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>7495</th>\n      <td>Contino</td>\n      <td>Reserva</td>\n      <td>2016</td>\n      <td>4.2</td>\n      <td>392</td>\n      <td>Espana</td>\n      <td>Rioja</td>\n      <td>19.98</td>\n      <td>Rioja Red</td>\n      <td>4.0</td>\n      <td>3.0</td>\n    </tr>\n    <tr>\n      <th>7496</th>\n      <td>Conreria d'Scala Dei</td>\n      <td>Les Brugueres</td>\n      <td>2018</td>\n      <td>4.2</td>\n      <td>390</td>\n      <td>Espana</td>\n      <td>Priorato</td>\n      <td>16.76</td>\n      <td>Priorat Red</td>\n      <td>4.0</td>\n      <td>3.0</td>\n    </tr>\n    <tr>\n      <th>7497</th>\n      <td>Mustiguillo</td>\n      <td>Finca Terrerazo</td>\n      <td>2017</td>\n      <td>4.2</td>\n      <td>390</td>\n      <td>Espana</td>\n      <td>El Terrerazo</td>\n      <td>24.45</td>\n      <td>Red</td>\n      <td>4.0</td>\n      <td>3.0</td>\n    </tr>\n    <tr>\n      <th>7498</th>\n      <td>Matarromera</td>\n      <td>Gran Reserva</td>\n      <td>2011</td>\n      <td>4.2</td>\n      <td>389</td>\n      <td>Espana</td>\n      <td>Ribera del Duero</td>\n      <td>64.50</td>\n      <td>Ribera Del Duero Red</td>\n      <td>5.0</td>\n      <td>3.0</td>\n    </tr>\n    <tr>\n      <th>7499</th>\n      <td>Sei Solo</td>\n      <td>Preludio</td>\n      <td>2016</td>\n      <td>4.2</td>\n      <td>388</td>\n      <td>Espana</td>\n      <td>Ribera del Duero</td>\n      <td>31.63</td>\n      <td>Ribera Del Duero Red</td>\n      <td>5.0</td>\n      <td>3.0</td>\n    </tr>\n  </tbody>\n</table>\n<p>7500 rows Ã— 11 columns</p>\n</div>\n```\n:::\n:::\n\n\n::: {.cell execution_count=2}\n``` {.python .cell-code}\nunique_country = df['country'].nunique()\nprint(f\"Number of unique country: {unique_country}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nNumber of unique country: 1\n```\n:::\n:::\n\n\n::: {.cell execution_count=3}\n``` {.python .cell-code}\ncategorical_columns = ['winery', 'region', 'type']\nnumeric_columns = ['year', 'rating', 'num_reviews', 'price', 'body', 'acidity']\n\nX_categorical = df[categorical_columns]\nX_numeric = df[numeric_columns]\nX_numeric['year'] = pd.to_numeric(X_numeric['year'], errors='coerce')\n\nnan_indices = df['wine'].index[df['wine'].isnull()]\nX_categorical = X_categorical.drop(nan_indices)\nX_numeric = X_numeric.drop(nan_indices)\ny = df['wine'].drop(nan_indices)\n\nnumeric_transformer = Pipeline(steps=[\n    ('imputer', SimpleImputer(strategy='mean')),  \n    ('scaler', StandardScaler()),\n    ('pca', PCA(n_components=2))\n])\n\nX_processed_numeric = numeric_transformer.fit_transform(X_numeric)\n\ncategorical_transformer = Pipeline(steps=[\n    ('imputer', SimpleImputer(strategy='most_frequent')),  \n    ('onehot', OneHotEncoder(handle_unknown='ignore', sparse=False))\n])\n\nX_processed_categorical = categorical_transformer.fit_transform(X_categorical)\n\nresult_df_numeric = pd.DataFrame(data=X_processed_numeric, columns=['PC1', 'PC2'])\nresult_df_categorical = pd.DataFrame(X_processed_categorical, columns=categorical_transformer.named_steps['onehot'].get_feature_names_out(categorical_columns))\nresult_df = pd.concat([result_df_numeric, result_df_categorical], axis=1)\n\nX_train, X_test, y_train, y_test = train_test_split(result_df, y, test_size=0.2, random_state=42)\n\nnb_model = GaussianNB(var_smoothing=1e-02)\nnb_model.fit(X_train, y_train)\n\npredictions = nb_model.predict(X_test)\n\naccuracy = accuracy_score(y_test, predictions)\nrecall = recall_score(y_test, predictions, average='weighted')  # Change average as needed\nreport = classification_report(y_test, predictions)\n\nprint(f\"Accuracy: {accuracy:.2f}\")\nprint(f\"Recall: {recall:.2f}\")\nprint(\"Classification Report:\")\nprint(report)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAccuracy: 0.82\nRecall: 0.82\nClassification Report:\n                                                               precision    recall  f1-score   support\n\n                                                           17       0.00      0.00      0.00         0\n                                200 Monges Rioja Gran Reserva       0.00      0.00      0.00         0\n                                     200 Monges Rioja Reserva       1.00      1.00      1.00         2\n                  200 Monges Rioja Reserva Seleccion Especial       0.00      0.00      0.00         1\n                                          27 Ribera del Duero       0.00      0.00      0.00         1\n   30 Years V.O.R.S Very Old Palo Cortado Blend Medium Sherry       0.00      0.00      0.00         1\n                                 4 Varietales Coleccion Rioja       0.00      0.00      0.00         1\n                            A Torna dos Pasas Escolma Ribeiro       0.00      0.00      0.00         1\n                                                          AAA       0.00      0.00      0.00         0\n                                                     Albarino       1.00      1.00      1.00         1\n                                          Albarino Pedralonga       1.00      1.00      1.00         1\n                         Alenza Ribera del Duero Gran Reserva       0.00      0.00      0.00         1\n                                Alexander vs. The Ham Factory       0.00      0.00      0.00         1\n                                  Alicante Bouschet by Tarima       0.00      0.00      0.00         0\n                                             Alma Tobia Rioja       0.00      0.00      0.00         1\n                                                        Altar       0.00      0.00      0.00         1\n                                            Alto de la Caseta       1.00      1.00      1.00         1\n                                              Altos de Losada       0.98      1.00      0.99        50\n                                                      Amancio       0.00      0.00      0.00         2\n                                    Amaya Arzuaga (Coleccion)       0.00      0.00      0.00         1\n                                             Amontillado Saca       0.00      0.00      0.00         1\n                                          Amontillado V.O.R.S       0.00      0.00      0.00         1\n                                          Anada Pedro Ximenez       0.00      0.00      0.00         0\n                                       Angel Ribera del Duero       0.00      0.00      0.00         1\n                                            Antigues Reserves       0.00      0.00      0.00         1\n                                         Antique Palo Cortado       0.00      0.00      0.00         1\n                                             Aquilon Garnacha       1.00      1.00      1.00         1\n                                                          Aro       1.00      0.50      0.67         2\n                                                       Arousa       0.00      0.00      0.00         1\n                              Atteca Armas Garnacha Old Vines       0.00      0.00      0.00         1\n                                                        Aurus       0.33      0.50      0.40         2\n                                Baron de Chirel Rioja Reserva       0.25      0.50      0.33         2\n                                                      Barrica       0.00      0.00      0.00         1\n                                          Belondrade y Lurton       1.00      1.00      1.00         3\n                                                       Blanco       0.00      0.00      0.00         2\n                                            Blanco de Parcela       0.00      0.00      0.00         1\n                                             Blecua Somontano       1.00      1.00      1.00         1\n                                                 Branco Vermu       0.00      0.00      0.00         1\n                                               Brega Garnacha       0.00      0.00      0.00         0\n                                                        Bruto       1.00      1.00      1.00         1\n                                             Cabrida Montsant       0.00      0.00      0.00         0\n                                               Calvario Rioja       0.50      0.33      0.40         3\n                                              Cami Pesseroles       1.00      0.50      0.67         4\n                                               Cami de Cormes       0.00      0.00      0.00         1\n                                              Campus Gothorum       0.00      0.00      0.00         1\n                                    Candela Cream Dulce Sweet       1.00      1.00      1.00        43\n                                              Canta la Perdiz       0.00      0.00      0.00         0\n                                                      Capitel       0.00      0.00      0.00         2\n                                   Cardenal Palo Cortado VORS       0.00      0.00      0.00         0\n                                       Cartago Paraje de Pozo       1.00      1.00      1.00         2\n                                        Casa Cisca Monastrell       1.00      1.00      1.00         1\n                   Castillo Ygay Gran Reserva Especial Blanco       0.00      0.00      0.00         1\n                    Castillo Ygay Gran Reserva Especial Tinto       0.33      0.33      0.33         3\n                      Castillo de Monte la Reina Cuvee Privee       0.00      0.00      0.00         0\n                                           Cava Celler Batlle       0.50      1.00      0.67         1\n                                  Cava El Tros Nou Pinot Noir       0.00      0.00      0.00         1\n                         Cava Kripta Gran Reserva Brut Nature       0.50      1.00      0.67         1\n                                 Cava Original Brut (Espumos)       0.00      0.00      0.00         1\n                     Cayetano del Pino Viejisimo Palo Cortado       0.00      0.00      0.00         1\n                                   Cerrado del Castillo Rioja       1.00      1.00      1.00         1\n                                        Cerro La Isa Garnacha       0.00      0.00      0.00         1\n                                                  Clos Adrien       0.33      1.00      0.50         1\n                                           Clos Fonta Priorat       0.75      1.00      0.86         3\n                                                Clos Martinet       0.40      1.00      0.57         2\n                                                 Clos Monlleo       1.00      1.00      1.00         1\n                                               Clos de L'Obac       0.50      1.00      0.67         1\n                                        Clos del Portal Somni       1.00      1.00      1.00        46\n                                           Club Rioja Reserva       0.00      0.00      0.00         1\n                                            Coleccion Privada       1.00      1.00      1.00        46\n                         Coleccion Roberto Amillo Amontillado       0.00      0.00      0.00         0\n                        Coleccion Roberto Amillo Palo Cortado       0.00      0.00      0.00         1\n                                              Coleccion Syrah       0.00      0.00      0.00         1\n                                     Coliseo Amontillado VORS       0.00      0.00      0.00         1\n                                                    Corimbo I       1.00      1.00      1.00        43\n             Corpinnat Enoteca Reserva Particular de Recaredo       0.00      0.00      0.00         1\n                                Corpinnat Terrers Brut Nature       1.00      1.00      1.00         1\n                                                      Cosecha       1.00      1.00      1.00         1\n                                           Coster d'en Fornos       0.00      0.00      0.00         1\n                                                      Crianza       0.00      0.00      0.00         2\n                                                Crianza Tinto       0.00      0.00      0.00         0\n                                    Cuatro Palmas Amontillado       0.00      0.00      0.00         0\n                                        Cuesta de Las Liebres       0.50      1.00      0.67         1\n                                                Cuvee Palomar       0.00      0.00      0.00         0\n                                                Cuvee Verdejo       0.00      0.00      0.00         1\n                                                 Dalmau Rioja       1.00      0.67      0.80         3\n                               Delicado Cosecha Pedro Ximenez       1.00      1.00      1.00         1\n                                                  Dolc Mataro       0.00      0.00      0.00         0\n                                               Dolc de L'Obac       0.00      0.00      0.00         1\n                                            Dominio de Atauta       1.00      1.00      1.00         1\n                                            Dominio del Pidio       0.00      0.00      0.00         2\n                                  Dominio del Verso Red Blend       0.00      0.00      0.00         1\n                                    Don PX Convento Seleccion       1.00      1.00      1.00         2\n                                          Don PX Gran Reserva       0.00      0.00      0.00         0\n                                         Don PX Pedro Ximenez       0.00      0.00      0.00         1\n                                             Don PX Seleccion       0.50      1.00      0.67         1\n                      Doroteo Edicion Especial 25 Aniversario       0.00      0.00      0.00         1\n      Dos Cortados Palo Cortado Solera Especial Aged 20 Years       0.00      0.00      0.00         0\n                                                    El Anejon       0.00      0.00      0.00         1\n                                     El Cabernet F - Familiar       0.00      0.00      0.00         0\n                                           El Canto del Angel       0.00      0.00      0.00         1\n                                                  El Carretil       1.00      0.50      0.67         2\n                                                   El Puntido       0.96      1.00      0.98        27\n                                      El Puntido Gran Reserva       0.00      0.00      0.00         1\n                                         El Reventon Cebreros       0.00      0.00      0.00         1\n                                                  El Rocallis       1.00      1.00      1.00         1\n                                         El Titan del Bendito       0.00      0.00      0.00         0\n                                              El Velado Tinto       0.00      0.00      0.00         1\n                                                     El Viejo       1.00      1.00      1.00        42\n                                                        Elite       1.00      1.00      1.00         1\n                                                Els Escurcons       0.00      0.00      0.00         1\n                                          Emeritvs (Emeritus)       0.00      0.00      0.00         2\n                                      Emporda Aires de Garbet       0.00      0.00      0.00         0\n                               Envidiacochina (Tete de Cuvee)       0.00      0.00      0.00         1\n                           Faustino de Autor Reserva Especial       0.00      0.00      0.00         1\n                                        Finca Biniagual Veran       0.00      0.00      0.00         1\n                                            Finca Cascorrales       0.00      0.00      0.00         0\n                              Finca Cuesta Clara Raro Reserva       0.50      1.00      0.67         1\n                                                   Finca Dofi       0.33      1.00      0.50         1\n                                               Finca El Canto       0.00      0.00      0.00         1\n                                               Finca El Otero       1.00      1.00      1.00         1\n                                   Finca Iscorta Gran Reserva       0.00      0.00      0.00         1\n                              Finca La Colina Sauvignon Blanc       0.00      0.00      0.00         1\n                    Finca La Emperatriz Vinedo Singular Tinto       0.00      0.00      0.00         1\n                                      Finca Las Comas Verdejo       0.00      0.00      0.00         0\n                           Finca Los Hoyales Ribera del Duero       1.00      0.50      0.67         2\n                                                Finca Martelo       0.00      0.00      0.00         1\n                                              Finca Terrerazo       1.00      1.00      1.00        49\n                                              Finca el Bosque       0.33      1.00      0.50         1\n                                     Finca la Atalaya Reserva       0.00      0.00      0.00         0\n                                         Finca la Beata Bobal       0.00      0.00      0.00         1\n                                            Fino La Barajuela       0.00      0.00      0.00         0\n                              Flor de Primavera Peraj Ha'abib       0.00      0.00      0.00         1\n                                       Fondillon Gran Reserva       0.00      0.00      0.00         0\n                                            Formiga de Vellut       0.00      0.00      0.00         0\n                                        Frank Gehry Selection       0.00      0.00      0.00         1\n                                                       Galena       0.00      0.00      0.00         3\n                                   Galiano Seleccion Especial       0.00      0.00      0.00         1\n                               Gallaecia Rias Baixes Albarino       0.00      0.00      0.00         0\n                                                     Garnacha       0.00      0.00      0.00         3\n                                                      Gaudium       0.50      1.00      0.67         1\n                                                      Gessami       1.00      1.00      1.00         1\n                                             Giro de Abargues       0.00      0.00      0.00         1\n                                              Godina Garnacha       0.00      0.00      0.00         0\n                                                     Graciano       0.00      0.00      0.00         0\n                                            Gran Buig Priorat       0.00      0.00      0.00         1\n                                                 Gran Reserva       0.83      0.98      0.90        91\n                                    Gran Reserva Penas Aladas       1.00      0.50      0.67         2\n                                Gran Reserva Ribera del Duero       0.00      0.00      0.00         0\n                                           Gran Reserva Rioja       1.00      1.00      1.00        50\n                              Gran Reserva Rioja (Finca Ygay)       0.50      1.00      0.67         1\n                                         Grandes Anadas Rioja       1.00      1.00      1.00         1\n                                    Granja Gran Reserva Rioja       1.00      1.00      1.00         1\n                                                        Habis       0.00      0.00      0.00         0\n                                          Hacienda Pradolagar       0.00      0.00      0.00         0\n                                              Heretge Priorat       0.00      0.00      0.00         0\n                                               I Gran Reserva       0.50      0.50      0.50         2\n                                                         Idus       0.00      0.00      0.00         0\n                                               Interpretacion       1.00      1.00      1.00         1\nJalifa Amontillado Rare Old Dry Solera Especial Aged 30 Years       0.00      0.00      0.00         1\n                   Juan Piernas Finca El Paso Malo Monastrell       0.00      0.00      0.00         1\n                                                   Juegabolos       0.00      0.00      0.00         0\n                                                        Julia       0.00      0.00      0.00         1\n                                           Jumilla Blue Label       1.00      1.00      1.00         1\n                               L'Ermita Velles Vinyes Priorat       1.00      1.00      1.00         5\n                                                  La Aguilera       0.00      0.00      0.00         1\n                                                   La Baixada       0.00      0.00      0.00         1\n                                                    La Baraja       0.00      0.00      0.00         0\n                                                   La Basseta       1.00      1.00      1.00         1\n                                               La Bienquerida       0.50      1.00      0.67         1\n                                    La Bota 69 de Amontillado       0.00      0.00      0.00         0\n                              La Bota 90 de Manzanilla Pasada       0.00      0.00      0.00         1\n                                                 La Creu Alta       1.00      1.00      1.00         1\n                                       La Cuartilleja Reserva       0.00      0.00      0.00         2\n                                  La Cueva del Contador Rioja       1.00      1.00      1.00         2\n                                       La Hormiga de Antidoto       0.00      0.00      0.00         1\n                                                       La Mar       0.00      0.00      0.00         0\n                                      La Morera de San Lazaro       0.00      0.00      0.00         1\n                                        La Mula de la Quietud       1.00      1.00      1.00         1\n                                                     La Nieta       1.00      1.00      1.00         1\n                                       La Poza de Ballesteros       0.33      1.00      0.50         1\n                                   La Riva Fino Balbaina Alta       0.00      0.00      0.00         0\n                                               La Solana Alta       1.00      1.00      1.00         1\n                                                      La Time       0.00      0.00      0.00         1\n                                                Laderas Rioja       0.00      0.00      0.00         0\n                                         Laderas de Inurrieta       0.00      0.00      0.00         0\n                                      Las Cenizas Tempranillo       0.00      0.00      0.00         1\n                                       Las Iruelas El Tiemblo       0.00      0.00      0.00         0\n                                  Las Lamas Bierzo (Corullon)       1.00      1.00      1.00         1\n                                                   Las Sabias       0.00      0.00      0.00         1\n                                  Le Domaine Blanco de Guarda       1.00      1.00      1.00         1\n                                                      Le Rose       0.00      0.00      0.00         1\n            Lealtanza Coleccion de Artistas Espanoles Sorolla       0.00      0.00      0.00         0\n                                       Les Aubaguetes Priorat       0.00      0.00      0.00         1\n                                                Les Brugueres       1.00      1.00      1.00        40\n                                                   Les Manyes       0.00      0.00      0.00         2\n                                                   Les Tosses       0.00      0.00      0.00         0\n                         Llanos del Almendro Ribera del Duero       1.00      1.00      1.00         2\n                                            Lo Cabalo Reserva       0.00      0.00      0.00         1\n                         Los Dominios de Berceo Prefiloxerico       0.00      0.00      0.00         1\n                                               Los Tabaqueros       0.00      0.00      0.00         0\n                                                        Macan       1.00      1.00      1.00         1\n                                                Macan Clasico       1.00      1.00      1.00         1\n                                                       Malbec       0.00      0.00      0.00         0\n                                                    Malleolus       1.00      1.00      1.00         1\n                                    Malleolus de Sanchomartin       0.33      0.33      0.33         3\n                                    Malleolus de Valderramiro       0.00      0.00      0.00         2\n                                                     Malvasia       0.00      0.00      0.00         0\n                                             Manar dos Seixas       0.00      0.00      0.00         0\n                                                     Manyetes       0.00      0.00      0.00         0\n                                      Maria Remirez de Ganuza       0.00      0.00      0.00         1\n                  Marques de Poley Amontillado Seleccion 1951       0.00      0.00      0.00         1\n                                              Martelo Reserva       0.50      1.00      0.67         1\n                                        Marti Reserva Penedes       0.00      0.00      0.00         2\n                                               Martires Rioja       1.00      1.00      1.00         1\n                              Mas La Plana Cabernet Sauvignon       1.00      1.00      1.00         1\n                                               Mas de la Rosa       0.00      0.00      0.00         1\n                                                       Masdeu       0.00      0.00      0.00         2\n                 Massipa de Scala Dei Garnatxa Blanca - Xenin       0.00      0.00      0.00         0\n                                                    Matallana       1.00      1.00      1.00         1\n                                            Millenium Reserva       0.00      0.00      0.00         0\n                                                        Mirto       1.00      1.00      1.00        36\n                                                      Monreal       0.00      0.00      0.00         0\n                                             Moradillo de Roa       0.00      0.00      0.00         0\n                            Musivari Gran Reserva Brut Nature       0.00      0.00      0.00         1\n                                                      Naiades       0.00      0.00      0.00         1\n                                 Navarra Coleccion 125 Blanco       1.00      1.00      1.00         1\n                                       Nebro Ribera del Duero       1.00      1.00      1.00         1\n                                  Nit de Nin Mas d'en Cacador       0.00      0.00      0.00         2\n                                                       No. 20       0.00      0.00      0.00         0\n                                                       No. 23       0.00      0.00      0.00         1\n                                                       Nobbis       0.00      0.00      0.00         1\n                                                       Nounat       1.00      1.00      1.00        46\n                                                    Numanthia       0.00      0.00      0.00         1\n                                               Nus del Terrer       0.00      0.00      0.00         1\n                                                 Octogenarius       0.50      1.00      0.67         1\n                                                      Oloroso       0.00      0.00      0.00         1\n                                              Oloroso En Rama       0.00      0.00      0.00         1\n                                      Oloroso Extra Viejo 1/7       0.00      0.00      0.00         0\n                                                        Orbus       0.00      0.00      0.00         1\n                               Oscar Tobia Gran Reserva Rioja       0.00      0.00      0.00         0\n                    PS (Pagos Seleccionados) Ribera del Duero       0.00      0.00      0.00         0\n                                           Pago De Valtarrena       0.00      0.00      0.00         1\n                                               Pago El Espino       0.00      0.00      0.00         1\n                                               Pago Negralada       1.00      1.00      1.00         1\n                                         Pago de Las Costanas       0.00      0.00      0.00         1\n                                           Pago de Santa Cruz       1.00      0.50      0.67         2\n             Pago de Santa Cruz Gran Reserva Ribera del Duero       0.00      0.00      0.00         1\n                                     Palmeri Navalta Garnacha       0.00      0.00      0.00         1\n                                                  Pantocrator       0.00      0.00      0.00         1\n                                       Parcela El Nogal Tinto       0.00      0.00      0.00         2\n                                       Parcela El Picon Tinto       0.50      1.00      0.67         1\n                   Parcelas de Maturana Tinta Coleccion Rioja       0.00      0.00      0.00         0\n                                                  Pena Lobera       0.00      0.00      0.00         2\n                                         Penalba Lopez Blanco       0.00      0.00      0.00         0\n                         Perez Pascuas Gran Reserva Seleccion       1.00      1.00      1.00         1\n                                         Perfume de Sonsierra       0.00      0.00      0.00         0\n                                                    Perpetual       1.00      1.00      1.00         1\n                                       Pesus Ribera del Duero       0.00      0.00      0.00         2\n                                                 Petit Verdot       0.11      0.33      0.17         3\n                                                       Pingus       1.00      1.00      1.00         7\n                                                   Pinot Noir       0.00      0.00      0.00         1\n                                       Pla dels Angels Rosado       0.00      0.00      0.00         1\n                                           Porrera Vi de Vila       1.00      1.00      1.00         1\n                                      Prado Enea Gran Reserva       0.50      0.50      0.50         2\n                                                     Preludio       1.00      1.00      1.00        43\n                                                Prieto Picudo       0.00      0.00      0.00         2\n                                                   Primordium       0.00      0.00      0.00         1\n                                                      Priorat       0.40      0.80      0.53         5\n                                        Priorat Vinyes Velles       1.00      0.50      0.67         2\n                                  Purgatori Costers del Segre       1.00      1.00      1.00         2\n                                                           QS       1.00      1.00      1.00         1\n                                                  Quintanilla       0.00      0.00      0.00         1\n                           Recondita Armonia Monastrell Dulce       0.00      0.00      0.00         1\n                                Regina Vides Ribera del Duero       0.33      1.00      0.50         2\n                                            Rejon Tempranillo       1.00      1.00      1.00         2\n                                                      Reserva       0.86      0.52      0.65        73\n                                                Reserva 5 Ano       0.33      1.00      0.50         1\n                                             Reserva Especial       0.00      0.00      0.00         1\n                            Reserva Especial Ribera del Duero       0.00      0.00      0.00         1\n                                       Reserva Especial Rioja       0.00      0.00      0.00         1\n                                        Reserva Privada Rioja       0.00      0.00      0.00         1\n                                     Reserva Ribera del Duero       1.00      1.00      1.00         1\n                                   Reserva Rioja (Finca Ygay)       0.00      0.00      0.00         1\n                                                Reserva Tinto       0.50      0.67      0.57         3\n                                             Reserva Trajanvs       0.00      0.00      0.00         1\n                                                   Reserva XR       0.00      0.00      0.00         0\n                                                      Respeto       1.00      1.00      1.00         1\n                                           Respublica Verdejo       0.00      0.00      0.00         1\n                           Rias Baixas Albarino Finca Valinas       0.98      1.00      0.99        46\n                                             Ribas de Cabrera       0.00      0.00      0.00         1\n                                             Ribera del Duero       0.71      1.00      0.83         5\n                                   Ribera del Duero Prestigio       0.00      0.00      0.00         1\n                                         Ribera del Duero Red       1.00      1.00      1.00         2\n                                     Ribera del Duero Reserva       0.50      1.00      0.67         1\n                                         Ribera del Duero TSM       0.00      0.00      0.00         0\n                                  Ribera del Duero Una Cepa I       1.00      1.00      1.00         1\n                    Ribera del Duero Vendimia Seleccionada VT       0.00      0.00      0.00         1\n                                                        Rioja       0.00      0.00      0.00         1\n                                        Rioja 150 Aniversario       0.00      0.00      0.00         1\n                                                 Rioja Blanco       1.00      1.00      1.00        15\n                                                  Rioja Cisma       0.50      1.00      0.67         1\n                                               Rioja Graciano       0.58      1.00      0.73        42\n                                           Rioja Gran Reserva       0.50      0.20      0.29         5\n                                                  Rioja Norte       0.00      0.00      0.00         1\n                                                Rioja Reserva       0.92      0.92      0.92        48\n                                           Rioja Vina Coqueta       0.00      0.00      0.00         1\n                                                       Roc Nu       1.00      1.00      1.00        53\n                                           Roda Reserva Rioja       1.00      1.00      1.00         2\n                                                   Saca Unica       0.00      0.00      0.00         0\n                                                       Saktih       1.00      1.00      1.00         1\n                                                 Salinas 1237       0.00      0.00      0.00         1\n                                                       Salmos       0.00      0.00      0.00         1\n                                                      Salvaxe       1.00      1.00      1.00         1\n                                            San Vicente Rioja       1.00      1.00      1.00         1\n                                                   Santa Rosa       1.00      1.00      1.00        43\n                                              Sauvignon Blanc       0.00      0.00      0.00         1\n                              Seleccio Especial Vinyes Velles       0.67      1.00      0.80         2\n                                                    Seleccion       0.00      0.00      0.00         0\n                                           Seleccion Especial       0.00      0.00      0.00         0\n                                            Seleccion Privada       1.00      1.00      1.00         1\n                      Seleccion de Anada Albarino Rias Baixas       0.00      0.00      0.00         0\n                              Sericis Cepas Viejas Monastrell       0.00      0.00      0.00         1\n                                                       Sibila       0.00      0.00      0.00         0\n                                               Singular Negre       0.00      0.00      0.00         1\n                                                    Sio Negre       0.00      0.00      0.00         0\n                                                        Sofia       0.67      1.00      0.80         2\n                                                Solera BC-200       0.00      0.00      0.00         1\n                             Solera India Oloroso Rare Sherry       0.00      0.00      0.00         1\n                          Solera PAP Palo Cortado Rare Sherry       0.00      0.00      0.00         0\n                                                    Son Negre       1.00      1.00      1.00         1\n                               St Antoni de Scala Dei Priorat       0.00      0.00      0.00         1\n                                               Syrah (Shiraz)       0.00      0.00      0.00         0\n                                     Taberner Tierra de Cadiz       1.00      1.00      1.00         1\n                                                   Tabuerniga       0.00      0.00      0.00         0\n                                                       Teixar       0.00      0.00      0.00         3\n                                          Tempranillo Reserva       0.00      0.00      0.00         2\n                                                   Termanthia       0.80      1.00      0.89         4\n                                         Terras Gauda O Rosal       0.00      0.00      0.00         1\n                                 Terreus Paraje de Cueva Baja       1.00      1.00      1.00         1\n                                             Tintilla de Rota       1.00      1.00      1.00         1\n                                                        Tinto       0.71      0.42      0.53        12\n                                                           Tm       0.00      0.00      0.00         0\n                                                Tomas Esteban       0.00      0.00      0.00         1\n                                                         Toro       1.00      1.00      1.00         1\n                                                   Torre Muga       0.00      0.00      0.00         0\n                                      Tras Los Muros Albarino       0.00      0.00      0.00         1\n                                                    Trasnocho       0.00      0.00      0.00         0\n                                                   Treixadura       1.00      1.00      1.00        31\n                                                        Triga       1.00      1.00      1.00         1\n                                     Ultreia Valtuille Mencia       0.00      0.00      0.00         1\n                                                        Unico       0.67      0.75      0.71         8\n                               Unico Reserva Especial Edicion       0.00      0.00      0.00         5\n                                                          Uro       0.00      0.00      0.00         1\n                                                        Usted       0.00      0.00      0.00         1\n                                          V Dulce de Invierno       0.00      0.00      0.00         1\n                                                     V2 Tinto       1.00      1.00      1.00         1\n                                                           VS       0.00      0.00      0.00         0\n                                                  Valbuena 5o       0.44      0.80      0.57         5\n                                Valdegatiles Ribera del Duero       0.00      0.00      0.00         2\n                                                   Valdegines       0.95      1.00      0.97        38\n                                  Varietal Fermentacion Lenta       0.00      0.00      0.00         1\n                                          Vatan Tinta de Toro       1.00      1.00      1.00         2\n                                      Vd'O 1 Samso - Pissarra       0.00      0.00      0.00         1\n                                        Vendimia Seleccionada       0.00      0.00      0.00         1\n                                     Vendimia Tardia Moscatel       1.00      1.00      1.00         1\n                                                        Venus       0.00      0.00      0.00         0\n                                             Veraton Garnacha       1.00      1.00      1.00         1\n                                               Vermello Vermu       0.00      0.00      0.00         0\n                                                    Victorino       0.80      1.00      0.89         4\n                                         Vina Alberdi Crianza       1.00      1.00      1.00        48\n                                         Vina Alberdi Reserva       0.00      0.00      0.00         1\n                                         Vina Ardanza Reserva       0.50      1.00      0.67         1\n                                        Vina Bosconia Reserva       1.00      1.00      1.00         1\n                                       Vina Centenaria Mencia       0.00      0.00      0.00         1\n                                                Vina El Pison       1.00      0.80      0.89         5\n                                        Vina Tondonia Reserva       1.00      1.00      1.00         1\n                                 Vina Tondonia Reserva Blanco       0.00      0.00      0.00         1\n                               Vina de Martin Escolma Ribeiro       0.00      0.00      0.00         0\n                                               Vina del Olivo       1.00      1.00      1.00         1\n                                        Vinas Viejas Aguilera       0.00      0.00      0.00         1\n                                         Vinas Viejas Verdejo       0.50      1.00      0.67         2\n                       Vinas Viejas de Soria Ribera Del Duero       1.00      1.00      1.00         2\n                                 Vino de Autor Ribeiro Blanco       0.00      0.00      0.00         1\n                                         Vinyes Altes Porrera       1.00      1.00      1.00         1\n                                       Vinyes Velles de Samso       0.00      0.00      0.00         1\n                                                     Vobiscum       0.00      0.00      0.00         1\n\n                                                     accuracy                           0.82      1500\n                                                    macro avg       0.33      0.36      0.34      1500\n                                                 weighted avg       0.81      0.82      0.81      1500\n\n```\n:::\n:::\n\n\n::: {.cell execution_count=4}\n``` {.python .cell-code}\nprint(predictions)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n['Son Negre' 'Coleccion Privada' 'Rioja Reserva' ... 'Gran Reserva Rioja'\n 'Clos del Portal Somni' 'Rioja Graciano']\n```\n:::\n:::\n\n\n::: {.cell execution_count=5}\n``` {.python .cell-code}\nconf_matrix = confusion_matrix(y_test, predictions)\nconf_matrix_norm = conf_matrix / conf_matrix.sum(axis=1)[:, np.newaxis]\n\nplt.figure(figsize=(40, 30))\nsns.heatmap(conf_matrix_norm, annot=False, cmap='Purples')  \nplt.title('Normalized Confusion Matrix')\nplt.xlabel('Predicted')\nplt.ylabel('Actual')\nplt.show()\n# YlGnBu\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-6-output-1.png){width=2743 height=2310}\n:::\n:::\n\n\n::: {.cell execution_count=6}\n``` {.python .cell-code}\npca_model = numeric_transformer.named_steps['pca']\nexplained_variance = pca_model.explained_variance_ratio_\n\nplt.figure(figsize=(8, 6))\nplt.scatter(result_df['PC1'], result_df['PC2'], c='coral', alpha=0.5)\nplt.title('PCA Components: PC1 vs PC2')\nplt.xlabel('Principal Component 1 (PC1)')\nplt.ylabel('Principal Component 2 (PC2)')\n\n# Annotate explained variance\nplt.annotate(f'Explained Variance PC1: {explained_variance[0]:.2f}',\n             xy=(result_df['PC1'].min(), result_df['PC2'].max()), \n             xytext=(result_df['PC1'].min() + 1, result_df['PC2'].max() - 1),\n             arrowprops=dict(facecolor='black', arrowstyle='->'))\n\nplt.annotate(f'Explained Variance PC2: {explained_variance[1]:.2f}',\n             xy=(result_df['PC1'].max(), result_df['PC2'].min()), \n             xytext=(result_df['PC1'].max() - 2, result_df['PC2'].min() + 1),\n             arrowprops=dict(facecolor='black', arrowstyle='->'))\n\nplt.grid(True)\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-7-output-1.png){width=771 height=523}\n:::\n:::\n\n\n::: {.cell execution_count=7}\n``` {.python .cell-code}\nsvm = OneClassSVM(nu=0.03) \noutliers_svm = svm.fit_predict(X_processed_numeric)\nresult_df['is_outlier_svm'] = outliers_svm\n\nanomaly_points_svm = result_df[result_df['is_outlier_svm'] == -1]\n\nplt.figure(figsize=(8, 6))\nplt.scatter(result_df['PC1'], result_df['PC2'], alpha=0.5, c='coral', label='Normal')\nplt.scatter(anomaly_points_svm['PC1'], anomaly_points_svm['PC2'], color='red', marker='x', label='Anomaly (SVM)')\nplt.title('PCA Components: PC1 vs PC2 with Anomalies (SVM)')\nplt.xlabel('Principal Component 1 (PC1)')\nplt.ylabel('Principal Component 2 (PC2)')\nplt.legend()\nplt.grid(True)\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-8-output-1.png){width=675 height=523}\n:::\n:::\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}